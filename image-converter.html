async function downloadAll() {
    if (selectedFolder) {
        for (let img of convertedImages) {
            try {
                const response = await fetch(img.url);
                const blob = await response.blob();
                const fileHandle = await selectedFolder.getFileHandle(img.fileName, { create: true });
                const writable = await fileHandle.createWritable();
                await writable.write(blob);
                await writable.close();
            } catch (err) {
                console.error('保存文件时发生错误', err);
            }
        }
        alert('所有文件已保存到选定文件夹');
    } else {
        convertedImages.forEach(img => {
            const link = document.createElement('a');
            link.href = img.url;
            link.download = img.fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    }
    
    // 无论是否选择了保存路径，都更新下载链接的状态
    document.querySelectorAll('.download-link').forEach(link => {
        link.classList.add('downloaded');
    });
}
